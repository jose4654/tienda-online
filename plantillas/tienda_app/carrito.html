{% extends "base.html" %}

{% block titulo %}Carrito de compras{% endblock %}

{% block contenido %}
  <div class="container py-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h2>Carrito de compras</h2>
      {% if items_carrito %}
        <form action="{% url 'tienda_app:vaciar_carrito' %}" method="post">
          {% csrf_token %}
          <button class="btn btn-outline-danger" type="submit">
            <i class="fas fa-trash-alt"></i> Vaciar carrito
          </button>
        </form>
      {% endif %}
    </div>

    {% if items_carrito %}
      <div class="table-responsive sombra-suave">
        <table class="table align-middle">
          <thead class="table-light">
            <tr>
              <th>Producto</th>
              <th>Precio unitario</th>
              <th>Cantidad</th>
              <th>Subtotal</th>
              <th></th>
            </tr>
          </thead>
          <tbody>
            {% for item in items_carrito %}
              <tr>
                <td>
                  <div class="d-flex align-items-center">
                    <img src="{{ item.imagen|default:'https://via.placeholder.com/80x80?text=Sin+imagen' }}" class="miniatura-carrito me-3" alt="{{ item.nombre }}">
                    <div>
                      <strong>{{ item.nombre }}</strong><br>
                      <a href="{% url 'tienda_app:product_detail' item.slug %}" class="text-muted small">Ver detalle</a>
                    </div>
                  </div>
                </td>
                <td>${{ item.precio }}</td>
                <td>{{ item.cantidad }}</td>
                <td>${{ item.subtotal }}</td>
                <td>
                  <form action="{% url 'tienda_app:eliminar_del_carrito' item.pk %}" method="post">
                    {% csrf_token %}
                    <button class="btn btn-sm btn-outline-danger" type="submit">
                      <i class="fas fa-times"></i>
                    </button>
                  </form>
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

      <div class="d-flex justify-content-end mt-4">
        <div class="card sombra-suave" style="min-width: 320px;">
          <div class="card-body">
            <h5 class="card-title">Resumen</h5>
            <p class="card-text fs-4 fw-bold">Total: ${{ total }}</p>
            <div class="d-grid gap-2">
              <a href="{% url 'tienda_app:checkout' %}" class="btn btn-success">
                <i class="fas fa-credit-card"></i> Continuar al pago
              </a>
              <a href="{% url 'tienda_app:home' %}" class="btn btn-outline-primary">
                <i class="fas fa-shopping-bag"></i> Seguir comprando
              </a>
            </div>
          </div>
        </div>
      </div>
    {% else %}
      <div class="alert alert-info sombra-suave">
        Tu carrito está vacío. Explorá la <a href="{% url 'tienda_app:home' %}">tienda</a> y agregá productos.
      </div>
    {% endif %}
  </div>
{% endblock %}

