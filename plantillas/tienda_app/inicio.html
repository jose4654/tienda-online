{% extends "base.html" %}
{% load static %}

{% block titulo %}Inicio - MiTienda{% endblock %}

{% block contenido %}
  <section class="bg-primary text-white text-center py-5 mb-4">
    <div class="container">
      <h1 class="display-5 fw-bold">Bienvenido a MiTienda</h1>
      <p class="lead">Encontrá los mejores productos al mejor precio</p>
      <a href="#productos" class="btn btn-light btn-lg">Ver productos</a>
    </div>
  </section>

  <div class="container mb-4">
    <div class="d-flex justify-content-center flex-wrap gap-2">
      <button class="btn btn-outline-secondary {% if not categoria_actual %}active{% endif %}" data-category="todos">Todos</button>
      {% for categoria in categorias %}
        <button class="btn btn-outline-secondary {% if categoria.slug == categoria_actual %}active{% endif %}" data-category="{{ categoria.slug }}">
          {{ categoria.name }}
        </button>
      {% empty %}
        <span class="text-muted">No hay categorías cargadas aún.</span>
      {% endfor %}
    </div>
  </div>

  <div class="container" id="productos">
    <div class="row g-4">
      {% for producto in productos %}
        <div class="col-md-3 producto" data-category="{{ producto.category.slug }}">
          <div class="card h-100 sombra-suave">
            <img src="{{ producto.image_url|default:'https://via.placeholder.com/300x200?text=Sin+imagen' }}" class="card-img-top" alt="{{ producto.name }}">
            <div class="card-body d-flex flex-column">
              <h5 class="card-title">{{ producto.name }}</h5>
              <p class="card-text fw-bold">${{ producto.price }}</p>
              <p class="text-muted small flex-grow-1">{{ producto.description|truncatewords:12 }}</p>
              <div class="d-grid gap-2">
                <a href="{{ producto.get_absolute_url }}" class="btn btn-outline-primary">Ver detalle</a>
                {% if producto.is_in_stock %}
                  <form method="post" action="{% url 'tienda_app:agregar_al_carrito' producto.slug %}">
                    {% csrf_token %}
                    <button class="btn btn-primary w-100" type="submit">Agregar al carrito</button>
                  </form>
                {% else %}
                  <button class="btn btn-secondary w-100" disabled>Sin stock</button>
                {% endif %}
              </div>
            </div>
          </div>
        </div>
      {% empty %}
        <div class="col-12">
          <div class="alert alert-info sombra-suave">
            Todavía no hay productos publicados. Ingresá al panel de administración para cargarlos.
          </div>
        </div>
      {% endfor %}
    </div>
  </div>
{% endblock %}

{% block scripts_extra %}
  <script src="{% static 'js/filtros.js' %}"></script>
{% endblock %}

