{% extends "base.html" %}

{% block titulo %}Mis pedidos - MiTienda{% endblock %}

{% block contenido %}
<div class="container py-4">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <div>
      <h1 class="h3 mb-1">Mis pedidos</h1>
      <p class="text-muted mb-0">Historial de compras realizadas con tu cuenta.</p>
    </div>
    <a href="{% url 'tienda_app:home' %}" class="btn btn-outline-secondary">
      <i class="fas fa-arrow-left me-2"></i>Seguir comprando
    </a>
  </div>

  {% if pedidos %}
    <div class="table-responsive sombra-suave rounded-3 bg-white">
      <table class="table table-hover align-middle mb-0">
        <thead class="table-light">
          <tr>
            <th>#</th>
            <th>Fecha</th>
            <th>Estado</th>
            <th>Total</th>
            <th>Items</th>
            <th></th>
          </tr>
        </thead>
        <tbody>
          {% for pedido in pedidos %}
            <tr>
              <td class="fw-bold">#{{ pedido.pk }}</td>
              <td>{{ pedido.created_at|date:"d/m/Y H:i" }}</td>
              <td>
                {% if pedido.status == "completed" %}
                  <span class="badge text-bg-success">Completado</span>
                {% elif pedido.status == "pending" %}
                  <span class="badge text-bg-warning text-dark">Pendiente</span>
                {% elif pedido.status == "processing" %}
                  <span class="badge text-bg-info text-dark">En preparación</span>
                {% elif pedido.status == "shipped" %}
                  <span class="badge text-bg-primary">Enviado</span>
                {% else %}
                  <span class="badge text-bg-secondary">Cancelado</span>
                {% endif %}
              </td>
              <td>${{ pedido.total_amount }}</td>
              <td>
                <ul class="list-unstyled mb-0 small">
                  {% for item in pedido.items.all %}
                    <li>{{ item.quantity }} × {{ item.product.name }}</li>
                  {% empty %}
                    <li class="text-muted">Sin detalles</li>
                  {% endfor %}
                </ul>
              </td>
              <td class="text-end">
                <a class="btn btn-sm btn-outline-primary" href="{% url 'tienda_app:detalle_pedido' pedido.pk %}">
                  Ver detalle
                </a>
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  {% else %}
    <div class="text-center py-5 border rounded-3 bg-white sombra-suave">
      <i class="fas fa-box-open fa-3x text-muted mb-3"></i>
      <h2 class="h4 mb-2">Todavía no tenés compras</h2>
      <p class="text-muted mb-4">Cuando realices un pedido, aparecerá acá para que puedas seguirlo.</p>
      <a href="{% url 'tienda_app:home' %}" class="btn btn-primary">
        Ver productos
      </a>
    </div>
  {% endif %}
</div>
{% endblock %}

